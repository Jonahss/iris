var iris={};window.iris=iris,function(a){function b(){c={},iris.on("iris-reset",b)}var c;iris.on=function(b,d){c.hasOwnProperty(b)||(c[b]=[]);var e=c[b],f=a.inArray(d,e);-1===f&&e.push(d)},iris.off=function(b,d){if(c.hasOwnProperty(b))if(void 0!==d){var e=a.inArray(d,c[b]);-1!==e&&c[b].splice(e,1)}else delete c[b]},iris.notify=function(a,b){if(void 0===a)throw"[notify] event name parameter is not defined";if(c[a])for(var d=c[a],e=0;e<d.length;e++)d[e](b)},iris.destroyEvents=function(b,d){for(var e=c[b].concat([]),f=0;f<d.length;f++){var g=a.inArray(d[f],e);-1!==g&&e.splice(g,1)}c[b]=e},iris.Event=function(){this.events={}};var d=iris.Event.prototype;d.on=function(b,c){this.events.hasOwnProperty(b)||(this.events[b]=[]);var d=this.events[b],e=a.inArray(c,d);-1===e&&(d.push(c),iris.on(b,c))},d.off=function(b,c){var d=this.events[b];if(d){var e=a.inArray(c,d);-1!==e&&d.splice(e,1)}},d.notify=function(a,b){iris.notify(a,b)},iris.BEFORE_NAVIGATION="iris_before_navigation",iris.AFTER_NAVIGATION="iris_after_navigation",iris.RESOURCE_ERROR="iris_resource_error",b()}(jQuery),function(a){function b(){if("undefined"==typeof jQuery)throw"jQuery "+i+"+ previous load required";if(a().jquery<i)throw"jQuery "+a().jquery+" currently loaded, jQuery "+i+"+ required";window.console&&window.console.log&&Function.prototype.bind&&(h=Function.prototype.bind.call(window.console.log,window.console));var d=c("localhost","127.0.0.1");g=d,e=!d,iris.on("iris-reset",b)}function c(){for(var a=0;a<arguments.length;a++)if(document.location.href.indexOf(arguments[a])>-1)return!0;return!1}var d,e,f,g,h,i=1.5;iris.baseUri=function(a){if(void 0!==a)d=a;else if(void 0===d){var b=document.getElementsByTagName("base");b=b.length>0?b[0].attributes.href.value:"/",d=document.location.protocol+"//"+document.location.host+b}return d},iris.cache=function(a){return void 0===a?e:(e=a,void 0)},iris.cacheVersion=function(a){return void 0===a?f:(f=a,void 0)},iris.log=function(){h&&g&&h.apply(this,arguments)},iris.enableLog=function(){return arguments.length>0?(g=c.apply(this,arguments),void 0):g},iris.noCache=function(){return arguments.length>0?(e=!c.apply(this,arguments),void 0):!e},b()}(jQuery),function(a){function b(){e={}}function c(b,c){iris.log("[translations]",b,c),void 0===iris.locale()&&iris.locale(b),e.hasOwnProperty(b)||(e[b]={}),a.extend(e[b],c)}function d(a,b,d){iris.log("[translations]",a,b);var e={url:b,dataType:"json",async:!1,cache:iris.cache()};iris.cache()&&iris.cacheVersion()&&(e.data="_="+iris.cacheVersion()),iris.ajax(e).done(function(b){c(a,b),iris.log("[translations]",b),d&&d.hasOwnProperty("success")&&d.success(a)}).fail(function(c){throw d&&d.hasOwnProperty("error")&&d.error(a),"Error "+c.status+" loading lang file["+b+"]"})}var e;iris.translations=function(a,b,e){"object"==typeof b?c(a,b):d(a,b,e)},iris.translate=function(a,b){var c,d=null;d=void 0!==b?b:iris.locale();var f="[translate]";return e.hasOwnProperty(d)?(c=iris.val(e[d],a),void 0===c&&iris.log(f+" label '"+a+"' not found in Locale '"+d+"'",e[d]),"object"==typeof c&&iris.log(f+"label '"+a+"' is an object but must be a property in Locale '"+d+"'",e[d])):iris.log(f+" locale '"+d+"' not loaded",this),c?c:"??"+a+"??"},b()}(jQuery),function(){function a(){b=void 0,c={},iris.on("iris-reset",a)}var b,c;iris.locale=function(a,d){if("object"==typeof d)c[a]||(c[a]={}),$.extend(c[a],d),void 0===b&&(b=a);else{if(void 0===a)return b;b=a}},iris.regional=function(a){if(c.hasOwnProperty(b))return"undefined"==typeof a?c[b]:c[b].hasOwnProperty(a)?c[b][a]:void 0;throw"[regional] for locale '"+b+"' not found"},a()}(),function(a){function b(a){return 10>a?"0"+a:a}function c(a,c){var d=iris.regional();switch(a){case"y":return String(c.getFullYear()).substring(2);case"Y":return c.getFullYear();case"m":var e=c.getMonth()+1;return b(e);case"n":return c.getMonth()+1;case"M":return d.monthNames[c.getMonth()].substring(0,3);case"b":return d.monthNames[c.getMonth()].substring(0,3).toLowerCase();case"F":return d.monthNames[c.getMonth()];case"d":var f=c.getDate();return b(f);case"D":return d.dayNames[c.getDay()].substring(0,3);case"l":return d.dayNames[c.getDay()];case"s":var g=c.getSeconds();return b(g);case"i":var h=c.getMinutes();return b(h);case"H":var i=c.getHours();return b(i);case"h":var j=c.getHours();return j=0===j%12?12:j%12,b(j);case"a":return c.getHours()>12?"p.m.":"a.m.";case"A":return c.getHours()>12?"PM":"AM";case"U":return Math.floor(.001*c.getTime());default:return a}}function d(a){a=a.toLowerCase();var b=/(chrome)[ \/]([\w.]+)/.exec(a)||/(webkit)[ \/]([\w.]+)/.exec(a)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(a)||/(msie) ([\w.]+)/.exec(a)||a.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(a)||[];return{name:b[1]||"",version:b[2]||"0"}}iris.date=function(a,b){if(null===a)return"";b||(b=iris.regional("dateFormat")),"object"!=typeof a&&(a=new Date(a));for(var d="",e=0,f=b.length;f>e;e++)d+=c(b[e],a);return d},iris.ajax=function(b){return a.ajax(b)},iris.currency=function(b,c){var d={formatPos:"sn",formatNeg:"(sn)",symbol:"$"};a.extend(d,iris.regional("currency"),c);var e=iris.number(b,d);return e.replace("s",d.symbol)},iris.number=function(b,c){var d={formatPos:"n",formatNeg:"- n",decimal:".",thousand:",",precision:2};a.extend(d,iris.regional("number"),c);var e=Number(b),f=e>=0?d.formatPos:d.formatNeg,g=e%1,h=String(Math.abs(e-g));if(0===d.precision)h=parseInt(e.toFixed(),10);else{g=String(Math.abs(g).toFixed(d.precision)),g=g.substr(2);for(var i=0;i<Math.floor((h.length-(1+i))/3);i++)h=h.substring(0,h.length-(4*i+3))+d.thousand+h.substring(h.length-(4*i+3));h=h+d.decimal+g}return f.replace("n",h)},iris.val=function(a,b){var c;if(b.indexOf(".")>-1){var d,e=b.split("."),f=e.length;for(d=0;f>d&&void 0!==a;d++)a=a[e[d]];c=a}else c=a[b];return c};var e;iris.browser=function(){if(!e){var a=d(navigator.userAgent);e={},a.name&&(e[a.name]=!0,e.version=a.version),e.chrome?e.webkit=!0:e.webkit&&(e.safari=!0)}return e}}(jQuery),function(a){function b(){B={},C={},A={},D={},E=void 0,G={},H=!1,I=!1,J="",L=0,M=[],N={},O=[],iris.on("iris-reset",function(){a(window).off("hashchange"),document.location.hash="#",b()})}function c(b){if(H===!0)throw"the welcome screen already exists";H=!0,B["#"]=b,C["#"]=a(document.body),window.console&&window.console.log&&window.console.log("[iris] noCache["+iris.noCache()+"] enableLog["+iris.enableLog()+"]"),iris.hasOwnProperty("path")&&d(iris.path),O.length>0?f(O,e):e()}function d(a){if("string"==typeof a)G.hasOwnProperty(a)||O.push(a);else for(var b in a)d(a[b])}function e(){if(!("onhashchange"in window))throw"hashchange event unsupported";k(),a(window).on("hashchange",k)}function f(a,b){iris.log("[load-js]",a),K=b;for(var c,d,e=0;e<a.length;e++)G.hasOwnProperty(a[e])||(L++,c=/^https?:\/\//.test(a[e])?a[e]:String(iris.baseUri()+a[e]),iris.cache()?iris.cacheVersion()&&(c+="?_="+iris.cacheVersion()):c+="?_="+(new Date).getTime(),/\.html$/.test(a[e])?iris.ajax({url:c,dataType:"html",async:!0,componentPath:a[e]}).done(h):(d=document.createElement("script"),d.type="text/javascript",d.src=c,iris.browser().msie&&parseInt(iris.browser().version,10)<9?d.onreadystatechange=g:d.onload=i,P.appendChild(d)))}function g(){"loaded"===this.readyState&&i()}function h(a){G[this.componentPath]=a,i()}function i(){0===--L&&K()}function j(a){document.location.hash=a}function k(){if(!H)throw"set the first screen using iris.welcome()";var a=document.location.hash;if(""===a&&(a="#"),J===a)return!1;if(I)return I=!1,iris.notify(iris.AFTER_NAVIGATION),J=F,!1;iris.log("Starting a new navigation["+a+"]"),J=a,iris.notify(iris.BEFORE_NAVIGATION);var b,c,d,e=-1,f=a.split("/");if(void 0!==E){for(b=0;b<f.length;b++)if(void 0===E[b]||E[b]!==f[b]){e=b;break}if(d=e,-1===d&&f.length<E.length?d=f.length:0===e&&1===E.length&&(d=-1),1===f.length&&-1===e&&(e=1),-1!==d){for(b=E.length-1;b>=d;b--)if(c=o(E,b),A[c].canSleep()===!1)return I=!0,document.location.href=F,!1;for(b=E.length-1;b>=d;b--){var g=A[o(E,b)];g._sleep(),g.hide()}}}else e=0;if(-1!==e)for(b=e;b<f.length;b++){if(c=o(f,b),!C.hasOwnProperty(c))throw"'"+c+"' must be registered using self.screens()";if(!A.hasOwnProperty(c)){var h=v(c);h.create(),A[c]=h}var i=A[c],j=n(f[b]);i.show(),i._awake(j)}E=f,F=a,iris.log("Navigation finished"),iris.notify(iris.AFTER_NAVIGATION)}function l(a){return m(a.replace(/\?[^\/]*/,""))}function m(a){return a.replace(/\/$/,"")}function n(a){for(var b={},c=/([\.\w_\-]*)=([^&]*)/g,d=c.exec(a);d;)b[d[1]]=decodeURIComponent(d[2]),d=c.exec(a);return b}function o(a,b){for(var c="",d=0;b>=d;d++)c+="/"+l(a[d]);return c.substr(1)}function p(a){var b=a,c=b.match(/@@[0-9A-Za-z_\.]+@@/g);if(c){var d,e=c.length;for(d=0;e>d;d++)b=b.replace(c[d],iris.translate(c[d].substring(2,c[d].length-2)))}return b}function q(a,b){G[a]=b}function r(a,b){G[b]=a}function s(b,c,d,e,f,g){var h=new S;h.id=c,h.uis=[],h.uisMap={},h.el={},h.events={},h.con=b,h.fileJs=d,h.parentComponent=g,G[d](h),void 0!==f&&(h._tmplMode=f),e=void 0===e?{}:e;var i=t(b);return null===h.cfg&&(h.cfg={}),a.extend(h.cfg,i,e),h.create(i,e),h._awake(),h}function t(a){for(var b,c={},d=a.get(0).attributes,e=0,f=d.length;f>e;e++)b=d[e].name,0===b.indexOf("data-")&&(b=b.substr(5)),c[b]=d[e].value;return c}function u(a,b){G[b]=a}function v(a){var b=B[a],c=new T;return G[b](c),c.id=a,c.el={},c.uis=[],c.uisMap={},c.events={},c.con=C[a],c.fileJs=b,null===c.cfg&&(c.cfg={}),A[a]=c,c}function w(a){if(A.hasOwnProperty(a)){if("#"===a)throw"Welcome screen cannot be deleted";var b=document.location.hash;if("#"!==b&&""!==b&&(0===a.indexOf(b)||0===b.indexOf(a)))throw"Cannot delete the current screen or its parents";x(a)}else iris.log('Error removing the screen "'+a+'", path not found.')}function x(a){var b=A[a];if(void 0!==b){if(void 0!==b.screenChilds)for(var c=0;c<b.screenChilds.length;c++)x(b.screenChilds[c]);b._destroy(),b.get().remove(),delete D[B[a]],delete A[a],delete B[a],delete C[a]}}function y(a,b,c){for(var d,e,f=a,g=/##([0-9A-Za-z_\.]+)(?:\|(date|currency)(?:\(([^\)]+)\))*)?##/g,h=g.exec(a);h;){if(e=iris.val(b,h[1]),void 0!==e){if(d=h[2])switch(d){case"date":e=iris.date(e,h[3]);break;case"currency":e=iris.currency(e);break;default:iris.log("Unknow template format label '"+d+"' in '"+c+"'")}}else iris.log("Template param '"+h[1]+"' in '"+c+"' not found",b);f=f.replace(h[0],e),h=g.exec(a)}return f}function z(a,b){if("string"==typeof a){if(!G.hasOwnProperty(a))throw"add service["+a+"] to iris.path";return G[a]}var c=new iris.Resource;c.cfg={},c.settings({type:"json",path:""}),a(c),G[b]=c}var A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P=document.getElementsByTagName("head")[0],Q=function(){this.cfg=null};Q.prototype=new iris.Event,Q.prototype.settings=function(b){return null===this.cfg&&(this.cfg={}),a.extend(this.cfg,b)},Q.prototype.setting=function(a,b){return void 0===b?(this.cfg.hasOwnProperty(a)||iris.log("setting "+a+" not found",this.cfg,this),this.cfg[a]):(this.cfg[a]=b,void 0)};var R=function(){this.APPEND="append",this.REPLACE="replace",this.PREPEND="prepend",this.id=null,this.fileJs=null,this.fileTmpl=null,this.template=null,this.uis=null,this.uisMap=null,this.con=null,this.sleeping=null,this.el=null,this.events=null};R.prototype=new Q,R.prototype._sleep=function(){for(var a=0,b=this.uis.length;b>a;a++)this.uis[a]._sleep();this.sleeping=!0,this.sleep()},R.prototype._awake=function(a){this.sleeping=!1,this.awake(a);for(var b=0,c=this.uis.length;c>b;b++)this.uis[b].sleeping!==!1&&this.uis[b]._awake()},R.prototype._destroy=function(){this.sleeping||this._sleep();for(var a=0,b=this.uis.length;b>a;a++)this.uis[a]._destroy();for(var c in this.events)iris.destroyEvents(c,this.events[c]);this.destroy(),this.uis=null,this.events=null},R.prototype._tmpl=function(b,c,d){if(null!==this.template)throw"self.tmpl() has already been called in '"+this.fileJs+"'";this.fileTmpl=b;var e=p(G[b]),f=c?y(e,c,b):e,g=a(f);if(this.template=g,g.size()>1)throw"'"+b+"' must have only one root node";switch(d){case this.APPEND:this.con.append(g);break;case this.REPLACE:this.con.replaceWith(g),this.con={selector:this.con.selector};break;case this.PREPEND:this.con.prepend(g);break;default:throw"Unknown template mode '"+d+"'"}this.el={};var h=this.el;this.inflateTargets={};var i=this.inflateTargets,j=/(date|currency|number)(?:\(([^\)]+)\))/;a("*",g).each(function(b,c){var d,e,f,g,k,l=a(c),m=l.data(),n={},o={};for(var p in m)if("id"!==p)if(/Format$/.test(p))f=m[p],g=void 0,f&&j.test(f)&&(k=f.match(j),f=k[1],g=k[2]),n[p.replace(/Format$/,"")]={key:f,params:g};else{switch(p){case"jqText":d="_text_";break;case"jqHtml":d="_html_";break;case"jqVal":d="_val_";break;case"jqToggle":d="_toggle_";break;case"jqHtml":d="_html_";break;default:if(0===p.indexOf("jqAttr"))d="_attr_",e=p.substr(6).toLowerCase();else{if(0!==p.indexOf("jqCss"))continue;d="_css_",e=p.substr(5).toLowerCase()}}i.hasOwnProperty(m[p])||(i[m[p]]=[]);var q={target:d,targetParams:e,el:l};i[m[p]].push(q),o[p]=q}else h[m.id]=l;for(p in n)o.hasOwnProperty(p)&&(o[p].format=n[p].key,o[p].formatParams=n[p].params)})},R.prototype.inflate=function(a){var b,c,d,e,f,g,h;for(b in this.inflateTargets)if(g=iris.val(a,b))for(e=this.inflateTargets[b],c=0,d=e.length;d>c;c++){switch(f=e[c],f.format){case"date":h=iris.date(g,f.formatParams);break;case"currency":h=iris.currency(g);break;case"number":h=iris.number(g);break;default:h=g}switch(f.target){case"_text_":f.el.text(h);break;case"_html_":f.el.html(h);break;case"_val_":f.el.val(h);break;case"_toggle_":f.el.toggle(h);break;case"_attr_":f.el.attr(f.targetParams,h);break;case"_css_":f.el.css(f.targetParams,h)}}},R.prototype._checkTmpl=function(){if(null===this.template)throw"Set a template using self.tmpl() in '"+this.fileJs+"'"},R.prototype.show=function(){this._checkTmpl(),this.template.show()},R.prototype.hide=function(){this._checkTmpl(),this.template.hide()},R.prototype.get=function(a){if(this._checkTmpl(),a){if(!this.el.hasOwnProperty(a)){var b="[data-id="+a+"]",c=this.template.filter(b),d=null;if(c.length>0)d=c;else{var e=this.template.find(b);e.size()>0&&(d=e)}if(null===d)throw"[data-id="+a+"] not found in '"+this.fileTmpl+"' used by '"+this.fileJs+"'";if(d.size()>1)throw"[data-id="+a+"] must be unique in '"+this.fileTmpl+"' used by '"+this.fileJs+"'";this.el[a]=d}return this.el[a]}return this.template},R.prototype._ui=function(a,b,c,d){return void 0===b?this.uisMap[a]:this._createUi(a,b,c,d)},R.prototype._createUi=function(a,b,c,d){var e=this.get(a);if(void 0!==e&&1===e.size()){var f=s(e,e.data("id"),b,c,d,this);return(void 0===f._tmplMode||f._tmplMode===f.REPLACE)&&(this.el[a]=void 0),this.uis.push(f),f._tmplMode===f.REPLACE?this.uisMap[a]=f:(this.uisMap.hasOwnProperty(a)||(this.uisMap[a]=[]),this.uisMap[a].push(f)),f}throw"The container does not exist or has been replaced."},R.prototype.destroyUI=function(b){if(void 0===b)this.parentComponent.destroyUI(this);else{var c;if(c=a.inArray(b,this.uis),-1!==c&&this.uis.splice(c,1),b._tmplMode===b.REPLACE)this.uisMap[b.id]=null,delete this.uisMap[b.id];else{var d=this.uisMap[b.id];c=a.inArray(b,d),-1!==c&&d.splice(c,1)}b._destroy(),b.get().remove()}},R.prototype.destroyUIs=function(b){var c=this.uisMap[b];if(a.isArray(c)){var d;for(d=c.length-1;d>=0;d--)this.destroyUI(c[d])}else c&&c._tmplMode===this.REPLACE&&this.destroyUI(c)},R.prototype.container=function(){return this.con},R.prototype.create=function(){},R.prototype.awake=function(){},R.prototype.canSleep=function(){return!0},R.prototype.sleep=function(){},R.prototype.destroy=function(){};var S=function(){this._tmplMode="replace"};S.prototype=new R,S.prototype.tmplMode=function(a){this._tmplMode=a},S.prototype.tmpl=function(a,b){this._tmpl(a,b,this._tmplMode)},S.prototype.ui=function(a,b,c,d){return this._ui(a,b,c,d)};var T=function(){this.screenConId=null};T.prototype=new R,T.prototype.ui=function(a,b,c,d){if(a===this.screenConId)throw"'"+a+"' has already been registered as a screen container";return this._ui(a,b,c,d)},T.prototype.tmpl=function(a,b){this._tmpl(a,b,this.APPEND)},T.prototype.screens=function(a,b){if(this.screenConId=a,this.hasOwnProperty("screenChilds"))throw"Multiple calls to self.screens() are not allowed: "+this.id;if(null===this.template)throw"self.tmpl() must be called before self.screens(): "+this.id;var c=this.get(a);this.screenChilds=[];for(var d=0;d<b.length;d++){var e=b[d],f=e[0];if(-1!==f.indexOf("#"))throw"[self.screens] incorrect screen path["+f+"] cannot contain #";f=this.id+"/"+f;var g=e[1];if(D.hasOwnProperty(g))throw"[self.screens] js-URL repeated '"+g+"': "+this.id;if(C.hasOwnProperty(f))throw"[self.screens] hash-URL repeated  '"+f+"' in "+this.fileJs;iris.log("Register screen hash["+f+"] js["+g+"]"),B[f]=g,C[f]=c,D[g]=!0,this.screenChilds[d]=f}},iris.screen=u,iris.destroyScreen=w,iris.welcome=c,iris.navigate=j,iris.ui=r,iris.tmpl=q,iris.resource=z,iris.include=f,iris.Settable=Q,iris.Component=R,iris.UI=S,iris.Screen=T,b()}(jQuery),function(){var a=function(){};a.prototype=new iris.Settable,a.prototype.ajax=function(a,b,c,d,e){return iris.ajax({url:this.setting("path")+b,type:a,data:c,cache:!1,dataType:this.setting("type"),async:!0,success:d,error:function(a,b,c){iris.notify(iris.RESOURCE_ERROR,{request:a,status:b,error:c}),void 0!==e&&e()}})},a.prototype.get=function(a,b,c){return this.ajax("GET",a,null,b,c)},a.prototype.del=function(a,b,c){return this.ajax("DELETE",a,null,b,c)},a.prototype.put=function(a,b,c,d){return this.ajax("PUT",a,b,c,d)},a.prototype.post=function(a,b,c,d){return this.ajax("POST",a,b,c,d)},iris.Resource=a}();